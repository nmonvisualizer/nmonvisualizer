<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<head>
<title>NMONVisualizer - Custom Reports</title>
<link rel="stylesheet"href="nmonvisualizer.css" type="text/css" />
<link rel="icon" href="favicon.ico" type="image/png" />
</head>
<body>
<h1>NMONVisualizer</h1>
<h2 class="top">custom report format</h2>

<div id="nav">
  <a class="bold" href="index.html">Home</a><br/>
  <a href="screenshots.html">Screenshots</a><br/>
  <a href="iostat.html">IOStat</a><br/>
  <a href="fio.html">FIO</a><br/>
  <a href="json.html">JSON</a><br/>
  <a href="commandline.html">Command Line</a><br/>
  <a class="b" href="customreports.html">Custom Reports</a><br/>
  <a href="renaming.html">Renaming Hosts</a><br/>
  <a href="startup.html">Start nmon at Boot</a><br/>
  <hr/>
  <a href="https://github.com/nmonvisualizer/nmonvisualizer">Project on GitHub</a><br/>
  <a href="https://github.com/nmonvisualizer/nmonvisualizer/releases">Releases</a><br/>
  <a href="https://github.com/nmonvisualizer/nmonvisualizer/issues/new">Submit a Bug</a><br/>
</div>

<div id="content">
  <div class="section">
    <h2>Overview</h2>
    <p>NMONVisualizer supports generating custom reports from the <a href="commandline.html"/>command line</a>. Custom reports are defined in an XML file format, detailed here.</p>
  </div>

  <div class="section">
    <h2>Concepts</h2>
    <p>Four chart types are supported: line charts, bar charts, interval charts and histograms. Line charts <span class="i">always</span> have a time-based X axis; only the values charted and the Y axis are defined. Interval and histogram charts are similar except that the X axis plots all the intervals that are currently defined or the range of values in the histogram, respectively. A bar chart plots at least one aggregate statistic; both the Y axis and the columns (bar) names can be specified.</p>
    <p>To create lines or bars, one or more <span class="c">&lt;data&gt;</span> elements are specified for each chart. The data can either be all the data for a specific data type (<span class="c">&lt;type&gt;</span>) or one or more fields from the data type (<span class="c">&lt;field&gt;</span>). In either case, the type and / or field does not have to be exact; <a href="#matching">regular expression matching</a> and other specific substitutions are supported.</p>
    <p>In general, naming of lines and bars on a particular chart is very important. If a type or field is defined more than once or if renaming causes duplicates, only a single instance will appear on the chart. To assist with this, support exists for <a href="#renaming">renaming data</a> on the resulting chart.</p>
    <p>By default, a chart is created using data from all hosts (i.e. parsed data sets). An optional <span class="c">&lt;host&gt;</span> element can be used to restrict chart data to specific host names (exact or regex) or operating systems. Note that the program makes a distiction between (and processes differently) report XML files that should be run for a single host (i.e. a dataset report) and XML files that should be run across all hosts (i.e. a summary report, the 'All Systems' view). Therefore, it is best practice to have at least two report XML files defined: one to generate a set of charts for each host and another to generate charts that aggregate data for all hosts. Multiple, similar chart definitions differing only in their <span class="c">&lt;host&gt;</span> specifiction are usually not required. Instead, a common report will be applied to each host.</p>
  </div>

  <div class="section">
    <h2>Charts</h2>
    <p>The root element of the XML must be <span class="c">&lt;charts&gt;</span>. Within that, there can be any number of chart elements; each one will generate a separate graph. The four chart types each have their own element: <span class="c">&lt;linechart&gt;</span>, <span class="c">&lt;barchart&gt;</span>, <span class="c">&lt;intervalchart&gt;</span> and <span class="c">&lt;histogram&gt;</span>. All chart elements support the following attributes:
    <ul>
      <li><span class="c">name</span> - the name of the chart. This value is <span class="i"/>required</span>. This will be used as the title of the chart.</li>
      <li><span class="c">shortName</span> - a more concise name for the chart. This will be used as the file name when the chart is output as well as the tab name in the GUI. If not specified the short name will default to the full name.</li>
      <li><span class="c">stacked</span> - a a boolean value indicating that the lines or bars in the chart should be stacked rather than separate. On a line chart this causes the area between the lines to be filled in. This attribute is ignored for interval charts. The default value is <span class="c">false</span>.</li>
      <li><span class="c">width</span> and <span class="c">height</span> - the size of the chart when saved or copied, in pixels. The default is &#x00BC HD (1920 / 2 x 1080 / 2).
    </ul>
    </p>
    <p>Bar charts also support a <span class="c">subtractionNeeded</span> attribute to specify that the bar value should be subtracted from the previous bar's value. This is useful for stacked charts where the underlying data for each field is a sum of other data.</p>
    <p>Line and interval charts support a <span class="c">showDataPoints</span> attribute that defaults to <span class="c">true</span>. A value of <span class="c">false</span> will prevent the chart from displaying any data point markers on the chart lines.</p>
    <p>Histograms support a  <span class="c">bins</span> attribute to specify the number of bins to use in the chart. Each bin is displayed as a separate bar on the chart. This value defaults to <span class="c">10</span>. Histograms also support the ability to display annotation markers on a chart via the <span class="c">showMarkers</span> attribute and <span class="c">&lt;marker&gt;</span> sub-elements. Each <span class="c">&lt;marker&gt;</span> element requires a <span class="c">stat</span> attribute that corresponds to a valid <a href="#stat">statistic</a>. By default, <span class="c">showMarkers</span> is <span class="c">true</span> and markers are displayed for <span class="c">AVERAGE</span>, <span class="c">MEDIAN</span> and <span class="c">PERCENTILE_95</span>.<p>

    <h3>Naming &amp; Legends</h3>
    <p>By default, lines and bars as displayed in a chart legend, are named by their field. On bar charts, the X axis displays a category which defaults to the type name. Optional attributes exist to change the defaults.</p>
    <p>For line and interval charts, the attribute is <span class="c">linesNamedBy</span>. This is most useful when charting multiple types, each with the same field name. For bar charts, there are two attributes: <span class="c">barsNamedBy</span> and <span class="c">categoriesNamedBy</span>; these should not be set to the same value. Histograms support  <span class="c">barsNamedBy</span>.</p>
    <p>All charts also support a <span class="c">subtitledBy</span> attribute that adds a subtitle to the chart. By default, the subtitle naming mode is <span class="c">HOST</span>. Note that the naming mode is only applied if there is a single instance of the given value for the mode. For example, if the mode is <span class="c">HOST</span>, the hostname <span class="i">will not</span> be displayed if the chart displays data from multiple system. Similarly, for the compound naming modes, the actual subtitle may be shortened if one of the values is not unique for the charted data.</p>
    <p>The following naming modes are supported:
    <ul>
      <li><span class="c">HOST</span> - the hostname of the dataset</li>
      <li><span class="c">TYPE</span> - the name of the data type</li>
      <li><span class="c">FIELD</span> - the name of the field</li>
      <li><span class="c">STAT</span> - the name of a <a href="#stat">statistic</a></li>
      <li><span class="c">HOST_TYPE</span> - the hostname plus the type</li>
      <li><span class="c">HOST_FIELD</span> - the hostname plus the field</li>
      <li><span class="c">HOST_STAT</span> - the hostname plus the stat</li>
      <li><span class="c">TYPE_FIELD</span> - the type name plus the field</li>
      <li><span class="c">TYPE_STAT</span> - the type name plus the stat</li>
      <li><span class="c">FIELD_STAT</span> - the field name plus the stat</li>
      <li><span class="c">DATE</span> - the initial datetime of the data being charted, formatted as <span class="c">HH:mm:ss MMM dd</span>.<br/>The format can be changed by setting the <span class="c">dateFormat</span> attribute in the chart element. Any format supported by <a href="https://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a> is allowed. In addition, any of the above naming modes can be enclosed in single quotes. For example <span class="c">&lt;linechart name="CPU Utilization" shortName="CPU" stacked="true" subtitledBy="DATE" dateFormat="HH:mm 'HOST' 'TYPE'"&gt;</span> would create a subtitle like <span class="c">14:13 app1.foobar.com CPU_ALL</span>.
    </ul>
    </p>
    <p>Note that these values must be capitalized in the XML.</p>

    <h3>Data</h3>
    <p>Each chart must contain at least one <span class="c">&lt;data&gt;</span> element to define the data to be graphed. The data element must have one <span class="c">&lt;type&gt;</span> element and zero or more <span class="c">&lt;field&gt;</span> elements as children. Type elements are used to <a href="#matching">match</a> data types; field elements are used to match data within the given type. If no field element is specified, all fields for the matching types will be graphed.</p>
    <p>The <span class="c">&lt;data&gt;</span> element can have an optional <span class="c"><a href="#stat">stat</a></span> attribute. The default value for bar and interval charts is <span class="c">AVERAGE</span>. For line charts, this attribute is ignored &ndash; the raw data is always plotted.</p>

    <h3>Y Axis</h3>
    <p>Optional <span class="c">&lt;yAxis&gt;</span> and <span class="c">&lt;yAxis2&gt;</span> elements are supported for all chart types. Both support a <span class="c">label</span> attribute which specifies the name of the axis. The primary Y axis can also be set to a percentage scale with the <span class="c">asPercent</span> attribute, which must be a boolean. Note that to actually use the secondary Y axis, subsequent <span class="c">&lt;data&gt;</span> elements <span class="i">must</span> specify the <span class="c">useYAxis2</span> attribute as a boolean.</p>

    <h3>X Axis</h3>
    <p>An optional <span class="c">&lt;xAxis&gt;</span> element is supported for line, interval and bar charts. The <span class="c">label</span> attribute specifies the name of the axis. Percentages and secondary axes are not supported.
  </div>

  <div class="section">
    <a id="stat"><h2>Statistics</h2></a>
    <p>In addition to graphing data as-is, aggregate data can also be charted. This is done by specifing the <span class="c">stat</span> attribute in a <span class="c">data</span> element.</p>
    <p>The following statistics are supported:
    <ul>
      <li><span class="c">AVERAGE</span></li>
      <li><span class="c">WEIGHTED_AVERAGE</span> - this statistic calculates an average that weights larger values more than smaller values, especially values closer to 0. This is useful for data that have long idle periods followed by bursts. See <a href="https://www.ibm.com/developerworks/community/blogs/aixpert/entry/nmon_for_aix_15_years_on_and_still_learning1?lang=en">the NMON blog</a> for more information.</li>
      <li><span class="c">MINIMUM</span></li>
      <li><span class="c">MEDIAN</span></li>
      <li><span class="c">PERCENTILE_95</span></li>
      <li><span class="c">PERCENTILE_99</span></li>
      <li><span class="c">MAX</span></li>
      <li><span class="c">STD_DEV</span></li>
      <li><span class="c">SUM</span></li>
      <li><span class="c">COUNT</span></li>
      <li><span class="c">GRANULARITY_MAX</span> - this statistic calculates a peak average using the current granularity as the time scale. The value reported is the <span class="i">maximum</span> peak average of all periods in the current interval.</li>
    </ul>
    </p>
    <p>Note that these values must be capitalized in the XML. The default value is <span class="c">AVERAGE</span>.</p>
    <p>For line charts, only <span class="c">AVERAGE</span>, <span class="c">MAXIMUM</span>, <span class="c">MINIMUM</span>, <span class="c">COUNT</span> and <span class="c">SUM</span> are supported. The statistic value will be calculated <span class="i">for each</span> granularity value. The default is <span class="c">AVERAGE</span>, which calculates the average value of all data within the granularity interval.</p>
  </div>

  <div class="section">
    <a id="matching"><h2>Selecting Data</h2></a>
    <p>Hosts, types and fields can all be selected by name or by regular expression. For matching a specific name, use the <span class="c">name</span> attribute. For regexes, use the <span class="c">regex</span> attribute. Both should not be specified in a single element. Note that the name must be capitalized <span class="i">exactly</span> how it is in the underlying data file; this usually means types are uppercase and fields are lowercase.</p>
    <p>For the <span class="c">regex</span> attribute, any valid regular expression that can be parsed by Java's <span class="c">Pattern</span> class is valid. Note that when escaping values with backslash, only a single <span class="c">\</span> is needed.</p>
    <p>For the <span class="c">name</span> attribute, there are several special values that can be used:
    <ul>
      <li><span class="c">$ALL</span> - matches all values. This is the default but can be useful in combination with renaming.</li>
      <li><span class="c">$PROCESSES</span> - matches all processes and returns only the aggregate process data if there are multiple processes with the same name.</li>
      <li><span class="c">$TOP_PROCESSES_BY_CPU</span> &amp; <span class="c">$TOP_PROCESSES_BY_MEMORY</span> - matches all processes and returns only the top 10 processes by CPU utilization or memory usage, respectively.</li>
      <li><span class="c">$DISKS</span> - matches all disks (e.g. <span class="c">/dev/sda</span> but not <span class="c">/dev/sda1</span>) for nmon <span class="c">DISK</span> data types.</li>
      <li><span class="c">$PARTITIONS</span> - matches all partitions for nmon <span class="c">DISK</span> data types.</li>
    </ul>
    </p>
    <p>Note for Perfmon data, the disks are identified by subtype (i.e. <span class="c">Logical Disk (C:)</span>). So, the <span class="c">$DISKS</span> and <span class='c'>$PARTITIONS</span> values are not valid for Windows data since they only work on base data types.</p>
    <p>For <span class="c">&lt;host&gt;</span> elements, an additional <span class="c">os</span> attribute can also be provided to specify that data should only be matched for a specific operating system. Accepted values for this attribute are <span class="c">UNIX</span>, <span class="c">LINUX</span>, <span class="c">AIX</span>, <span class="c">VIOS</span> and <span class="c">PERFMON</span>. These values <span class="i">are not</span> case sensitive.</p>
  </div>

  <div class="section">
    <a id="renaming"><h2>Renaming Data</h2></a>
    <p>Hosts, types and fields can all be renamed directly or with regular expressions. For explicit renaming, use the <span class="c">alias</span> attribute. For regexes, either the existing <span class="c">regex</span> attribute will be reused or an explicit <span class="c">aliasRegex</span> attribute can be specified. Both an alias and a regex should not be specified in a single element.</p>
    <p>For the <span class="c">aliasRegex</span> attribute, any valid regular expression that can be parsed by Java's <span class="c">Pattern</span> class is valid. Note that when escaping values with backslash, only a single <span class="c">\</span> is needed. By default, renaming with a regex uses the first matching group (i.e. parentheses). This matching group will be used as the new field name. The matching group can be changed by specifying the <span class="c">aliasByGroup</span> attribute. Full string replacement is also possible by specifying the <span class="c">aliasByReplacement</span> attribute. This attribute allows back references to matching groups, for example <span class="c">$1</span> to match the first group.</p>
    <p>Often it is not possible to craft a <span class="c">regexAlias</span> that can rename appropriately. However, a similar regex is still useful for matching data. To support this case, an optional <span class="c">&lt;fieldAlias&gt;</span> is also supported. This element requires both a <span class="c">name</span> and a <span class="c">value</span> attribute. The name matches the field exactly (regexes are not supported) and the value is the renamed alias.</p>
    <p>Note that it is almost always wrong to use a renaming attribute when also using a <span class="c">regex</span> attribute to match. If the regular expression matches more than one item, <span class="i">all</span> the items will be renamed. However, since names on a chart must be unique, only a single line or bar will appear on the chart.</p>
    <p>When using the <span class="c">regex</span> attribute, that same regular expression will be used to rename. If no renaming is required, either specify a <span class="c">&lt;fieldAlias&gt;</span> or set the attribute <span class="c">aliasByGroup=0</span> to indicate that the entire string should be used (i.e. no renaming).</p>
  </div>

  <div class="section">
    <h2>Examples</h2>
    <p>Graph CPU data in a stacked line chart for a single host. Graph with a percentage scale. Rename the fields to their full names without percent signs.
    <span class="c">
&lt;linechart name="CPU Utilization" shortName="CPU" stacked="true"&gt;
  &lt;yAxis label="% CPU" asPercent="true" /&gt;
  &lt;data&gt;
    &lt;type name="CPU_ALL" /&gt;
    &lt;field name="User%" alias="User" /&gt;
    &lt;field name="Sys%" alias="System" /&gt;
    &lt;field name="Wait%" alias="Wait" /&gt;
  &lt;/data&gt;
&lt;/linechart&gt;</span>
    </p>

    <p>Graph CPU data in a bar chart for all hosts. User, system and wait time bars (named by field) will be stacked. Each host will have a separate set of bars (categories).
    <span class="c">
&lt;barchart name="Average CPU Utilization" shortName="CPU" stacked="true" categoriesNamedBy="HOST" barsNamedBy="FIELD"&gt;
  &lt;yAxis label="% CPU" asPercent="true" /&gt;
  &lt;data&gt;
    &lt;type name="CPU_ALL" /&gt;
    &lt;field name="User%" alias="User" /&gt;
    &lt;field name="Sys%" alias="System" /&gt;
    &lt;field name="Wait%" alias="Wait" /&gt;
  &lt;/data&gt;
&lt;/barchart&gt;</span>
    </p>

    <p>Graph CPU data in an interval chart for all hosts. Create an average total CPU line for each host.
    <span class="c">
&lt;intervalchart name="Average CPU Utilization" shortName="CPU" linesNamedBy="HOST"&gt;
  &lt;yAxis label="% CPU" asPercent="true" /&gt;
  &lt;data&gt;
    &lt;type name="CPU_ALL" /&gt;
    &lt;field name="CPU%" /&gt;
  &lt;/data&gt;
&lt;/intervalchart&gt;</span><br/>
Note <span class="c">CPU%</span> in this example is a generated value. It is not in the original NMON file but is generated as <span class="c">User% + Sys%</span>.
</p>

    <p>XML files used by NMONVisualizer internally are in the <a href="https://github.com/nmonvisualizer/nmonvisualizer/tree/master/src/com/ibm/nmon/report"><span class="c">com.ibm.nmon.report</span></a> package.</p>
  </div>
</div>
</body>
</html>
